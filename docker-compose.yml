version: "3.8"

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: k-alert-backend
    restart: always
    volumes:
      - ./backend/sql_app.db:/app/sql_app.db # Persist SQLite DB
    environment:
      - REDIS_HOST=redis
    # Note: We don't expose ports here because we'll use Nginx proxy
    # If the Nginx is in another compose, they should share a network.
    networks:
      - k-alert-net

  frontend-builder:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: k-alert-frontend-builder
    volumes:
      - k-alert-dist:/app/dist # Share built files through volume
    networks:
      - k-alert-net

networks:
  k-alert-net:
    driver: bridge

volumes:
  k-alert-dist: # Named volume for built frontend files
